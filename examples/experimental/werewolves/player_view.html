<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Duskmire Werewolves - Aurora Harper</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        gap: 20px;
        padding: 20px;
        background: #1a1a2e;
        color: #eee;
        margin: 0;
      }
      .sidebar {
        width: 250px;
        flex-shrink: 0;
      }
      .main-content {
        flex: 1;
        max-width: 900px;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .header h1 {
        margin: 0 0 10px 0;
        color: white;
        font-size: 24px;
      }
      .header .info {
        color: #f0f0f0;
        font-size: 14px;
      }
      .players-box {
        background: #16213e;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .players-box h3 {
        margin-top: 0;
        color: #667eea;
        font-size: 16px;
      }
      .players-box ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .players-box li {
        padding: 8px;
        margin: 5px 0;
        background: #1a1a2e;
        border-radius: 5px;
        font-size: 14px;
      }
      .input-box {
        background: #16213e;
        padding: 20px;
        border-radius: 10px;
        position: sticky;
        top: 20px;
      }
      .input-box h3 {
        margin-top: 0;
        color: #667eea;
        font-size: 16px;
      }
      .input-box.waiting {
        background: #27ae60;
        animation: pulse 2s infinite;
      }
      .action-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      .action-btn {
        flex: 1;
        min-width: 80px;
        padding: 10px;
        border: 2px solid #667eea;
        background: #1a1a2e;
        color: #eee;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }
      .action-btn:hover {
        background: #667eea;
      }
      .action-btn.selected {
        background: #667eea;
        border-color: #764ba2;
      }
      textarea {
        width: 100%;
        padding: 10px;
        background: #1a1a2e;
        border: 2px solid #667eea;
        border-radius: 5px;
        color: #eee;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
        min-height: 80px;
        box-sizing: border-box;
      }
      .submit-btn {
        width: 100%;
        padding: 12px;
        background: #27ae60;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
      }
      .submit-btn:hover {
        background: #2ecc71;
      }
      .event {
        background: #16213e;
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      .event.phase {
        border-left-color: #f39c12;
        background: #2c3e50;
      }
      .event.death {
        border-left-color: #e74c3c;
        background: #341a1a;
      }
      .event.speak {
        border-left-color: #3498db;
      }
      .event.action {
        border-left-color: #e67e22;
      }
      .timestamp {
        color: #95a5a6;
        font-size: 12px;
        margin-bottom: 5px;
      }
      .speaker {
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }
      .content {
        line-height: 1.6;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="players-box">
        <h3>üë• Players</h3>
        <ul>
          <li>Aurora Harper</li>
          <li>Bram Nightshade</li>
          <li>Celeste Moonseer</li>
          <li>Dorian Blackwood</li>
          <li>Elise Farrow</li>
          <li>Finn Alder</li>
        </ul>
      </div>

      <div class="input-box" id="inputBox">
        <h3>üéÆ Your Action</h3>
        <div id="status">Waiting for your turn...</div>
        <div id="inputControls" style="display: none">
          <div class="action-buttons" id="actionButtons"></div>
          <textarea
            id="argument"
            placeholder="Enter your message or action..."
            style="display: none"
          ></textarea>
          <button class="submit-btn" onclick="submitAction()">
            Submit Action
          </button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="header">
        <h1>üåï Duskmire Werewolves</h1>
        <div class="info">
          <strong>You are:</strong> Aurora Harper |
          <strong>Role:</strong> Villager
        </div>
      </div>
      <div id="events">
        <div class="event death">
          <div class="timestamp">01:08:55</div>

          <div class="content">Finn Alder was found dead at dawn.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:08:55</div>

          <div class="content">‚òÄÔ∏è Day breaks. Time to discuss!</div>
        </div>

        <div class="event speak">
          <div class="timestamp">01:09:31</div>
          <div class="speaker">Aurora Harper (You)</div>
          <div class="content">
            The loss of Finn is yet another blow to our already fragile
            community. It seems we are left with more questions than answers. I
            want to urge everyone to remain vigilant and take a step back; it‚Äôs
            easy to blame the previously quiet members among us, but let's not
            ignore the patterns forming with those who speak. Perhaps it would
            be wise to reflect upon our discussions; was anyone particularly
            eager to push away suspicion from themselves? I feel we have to be
            careful about how we proceed. Who do we turn our focus to now, and
            what else can we learn from our past mistakes?
          </div>
        </div>

        <div class="event speak">
          <div class="timestamp">01:09:33</div>
          <div class="speaker">Bram Nightshade</div>
          <div class="content">
            While Finn‚Äôs death weighs heavily on all of us, I believe we need to
            consider not just the quiet ones, but those who seemed almost eager
            to jump into blame. It's easy to toss accusations around without
            reason when chaos reigns. Celeste, Dorian, what do you think? Are
            there any odd behaviors that stood out to you during our
            discussions?
          </div>
        </div>

        <div class="event speak">
          <div class="timestamp">01:09:37</div>
          <div class="speaker">Celeste Moonseer</div>
          <div class="content">
            Bram raises an important point. In times of fear, the urge to point
            fingers intensifies‚Äîand it‚Äôs often those who seem eager to distract
            us from our real adversaries. I have my suspicions as well,
            especially regarding those who‚Äôve spoken a little too
            enthusiastically against others rather than focusing on the tragedy
            we've just witnessed. I believe we must not let emotions cloud our
            judgment. The wolves could be among us, hidden behind a veil of
            innocence. Let's tread carefully and consider all behaviors, not
            just the quiet ones. But who among us stands out, and should we
            scrutinize them first?
          </div>
        </div>

        <div class="event speak">
          <div class="timestamp">01:09:40</div>
          <div class="speaker">Dorian Blackwood</div>
          <div class="content">
            I appreciate both of your insights, Bram and Celeste. It does seem
            wise to examine the more vocal among us, those who might seek to
            redirect blame rather than confront the harsh reality of what we‚Äôre
            facing together. In times of fear and uncertainty, I think we should
            also remember that our instincts, while valuable, can lead us astray
            if not backed by careful observation. Perhaps we should consider our
            actions prior to Finn‚Äôs death‚Äîwho had the most to gain from creating
            panic among us? We need to be meticulous in our approach as we
            strive to identify the true enemy among us.
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:09:43</div>

          <div class="content">üó≥Ô∏è Voting phase. Time to make your choice.</div>
        </div>

        <div class="event speak">
          <div class="timestamp">01:09:43</div>
          <div class="speaker">Elise Farrow</div>
          <div class="content">
            I appreciate all the thoughtful insights shared so far. It's clear
            we need to work together to parse through our emotions and
            observations. While it‚Äôs easy to point fingers, we must ask
            ourselves what evidence we have to support our suspicions. I agree
            with the notion that those who deflect blame can be seen as
            suspicious. What I noticed last night was a strange ease in how some
            reacted to Finn's death, as if they were more concerned about
            steering the narrative rather than mourning. Who can we trust to be
            transparent in their thoughts and actions?
          </div>
        </div>

        <div class="event action">
          <div class="timestamp">01:11:38</div>

          <div class="content">You performed action: vote Dorian Blackwood</div>
        </div>

        <div class="event action">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            üó≥Ô∏è Majority condemns Celeste Moonseer. Execution at twilight.
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:11:42</div>

          <div class="content">üó≥Ô∏è Votes are tallied.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:11:42</div>

          <div class="content">‚öñÔ∏è Twilight execution results.</div>
        </div>

        <div class="event action">
          <div class="timestamp">01:11:42</div>

          <div class="content">üó≥Ô∏è Aurora Harper voted for Dorian Blackwood</div>
        </div>

        <div class="event action">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            üó≥Ô∏è Bram Nightshade voted for Celeste Moonseer
          </div>
        </div>

        <div class="event action">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            üó≥Ô∏è Dorian Blackwood voted for Celeste Moonseer
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            üó≥Ô∏è Vote summary: Dorian Blackwood: 1, Celeste Moonseer: 2
          </div>
        </div>

        <div class="event death">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            Celeste Moonseer was executed. They belonged to team Villagers.
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:11:42</div>

          <div class="content">üåô Night returns.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">01:11:42</div>

          <div class="content">
            üéÆ Game Over! Winner: Werewolves. Reason: [God] Werewolves win; they
            now match the village.
          </div>
        </div>
      </div>
    </div>

    <script>
      let selectedAction = null;
      let lastEventCount = 0;

      function selectAction(button, action) {
        selectedAction = action;
        document.querySelectorAll(".action-btn").forEach((btn) => {
          btn.classList.remove("selected");
        });
        if (button) {
          button.classList.add("selected");
        }

        // Show/hide textarea based on action type
        const textarea = document.getElementById("argument");
        if (action === "none") {
          textarea.style.display = "none";
          textarea.value = "";
        } else {
          textarea.style.display = "block";
          textarea.focus();
        }
      }

      function submitAction() {
        if (!selectedAction) {
          alert("Please select an action first");
          return;
        }

        const argument = document.getElementById("argument").value;
        const data = {
          action_type: selectedAction,
          argument: argument,
          timestamp: new Date().toISOString(),
        };

        // Try to write file via fetch
        fetch("save_action", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then(() => {
            // Disable controls
            document.getElementById("inputControls").style.display = "none";
            document.getElementById("status").textContent =
              "Action submitted! Waiting for next turn...";
            document.getElementById("inputBox").classList.remove("waiting");
            selectedAction = null;
            document.getElementById("argument").value = "";
          })
          .catch((err) => {
            console.error("Failed to save action:", err);
            alert("Failed to submit action. Please try again.");
          });
      }

      // Poll for updates without full page reload
      function checkForUpdates() {
        const inputBox = document.getElementById("inputBox");
        const isWaiting = inputBox.classList.contains("waiting");

        fetch(window.location.href + "?t=" + Date.now())
          .then((r) => r.text())
          .then((html) => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");
            const newInputBox = doc.getElementById("inputBox");
            const newEvents = doc.getElementById("events");

            // Always update events area (even while waiting) without reloading
            if (newEvents) {
              document.getElementById("events").innerHTML = newEvents.innerHTML;
              scrollToBottom();
            }

            // Only reload when transitioning from not waiting -> waiting
            if (
              !isWaiting &&
              newInputBox &&
              newInputBox.classList.contains("waiting")
            ) {
              location.reload();
            }
          })
          .catch(() => {});
      }

      // Auto-scroll to bottom
      function scrollToBottom() {
        const mainContent = document.querySelector(".main-content");
        if (mainContent) {
          mainContent.scrollTop = mainContent.scrollHeight;
        }
      }

      scrollToBottom();
      // Check for updates every 2 seconds
      setInterval(checkForUpdates, 2000);
    </script>
  </body>
</html>
