<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Duskmire Werewolves - Bram Nightshade</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        gap: 20px;
        padding: 20px;
        background: #1a1a2e;
        color: #eee;
        margin: 0;
      }
      .sidebar {
        width: 250px;
        flex-shrink: 0;
      }
      .main-content {
        flex: 1;
        max-width: 900px;
      }
      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .header h1 {
        margin: 0 0 10px 0;
        color: white;
        font-size: 24px;
      }
      .header .info {
        color: #f0f0f0;
        font-size: 14px;
      }
      .players-box {
        background: #16213e;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      .players-box h3 {
        margin-top: 0;
        color: #667eea;
        font-size: 16px;
      }
      .players-box ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .players-box li {
        padding: 8px;
        margin: 5px 0;
        background: #1a1a2e;
        border-radius: 5px;
        font-size: 14px;
      }
      .input-box {
        background: #16213e;
        padding: 20px;
        border-radius: 10px;
        position: sticky;
        top: 20px;
      }
      .input-box h3 {
        margin-top: 0;
        color: #667eea;
        font-size: 16px;
      }
      .input-box.waiting {
        background: #27ae60;
        animation: pulse 2s infinite;
      }
      .action-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }
      .action-btn {
        flex: 1;
        min-width: 80px;
        padding: 10px;
        border: 2px solid #667eea;
        background: #1a1a2e;
        color: #eee;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }
      .action-btn:hover {
        background: #667eea;
      }
      .action-btn.selected {
        background: #667eea;
        border-color: #764ba2;
      }
      textarea {
        width: 100%;
        padding: 10px;
        background: #1a1a2e;
        border: 2px solid #667eea;
        border-radius: 5px;
        color: #eee;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
        min-height: 80px;
        box-sizing: border-box;
      }
      .submit-btn {
        width: 100%;
        padding: 12px;
        background: #27ae60;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
      }
      .submit-btn:hover {
        background: #2ecc71;
      }
      .event {
        background: #16213e;
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      .event.phase {
        border-left-color: #f39c12;
        background: #2c3e50;
      }
      .event.death {
        border-left-color: #e74c3c;
        background: #341a1a;
      }
      .event.speak {
        border-left-color: #3498db;
      }
      .event.action {
        border-left-color: #e67e22;
      }
      .timestamp {
        color: #95a5a6;
        font-size: 12px;
        margin-bottom: 5px;
      }
      .speaker {
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }
      .content {
        line-height: 1.6;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="players-box">
        <h3>üë• Players</h3>
        <ul>
          <li>Aurora Harper</li>
          <li>Bram Nightshade</li>
          <li>Celeste Moonseer</li>
          <li>Dorian Blackwood</li>
          <li>Elise Farrow</li>
          <li>Finn Alder</li>
        </ul>
      </div>

      <div class="input-box" id="inputBox">
        <h3>üéÆ Your Action</h3>
        <div id="status">Waiting for your turn...</div>
        <div id="inputControls" style="display: none">
          <div class="action-buttons" id="actionButtons"></div>
          <textarea
            id="argument"
            placeholder="Enter your message or action..."
            style="display: none"
          ></textarea>
          <button class="submit-btn" onclick="submitAction()">
            Submit Action
          </button>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="header">
        <h1>üåï Duskmire Werewolves</h1>
        <div class="info">
          <strong>You are:</strong> Bram Nightshade |
          <strong>Role:</strong> Werewolf
        </div>
      </div>
      <div id="events">
        <div class="event action">
          <div class="timestamp">02:30:11</div>

          <div class="content">You performed action: kill Aurora</div>
        </div>

        <div class="event death">
          <div class="timestamp">02:30:13</div>

          <div class="content">Aurora Harper was found dead at dawn.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:30:13</div>

          <div class="content">‚òÄÔ∏è Day breaks. Time to discuss!</div>
        </div>

        <div class="event speak">
          <div class="timestamp">02:32:50</div>
          <div class="speaker">Celeste Moonseer</div>
          <div class="content">
            This is a tragic loss for our village. Aurora was a shining light
            among us. We need to ensure her death isn‚Äôt in vain. I propose we
            discuss our suspicions. If anyone has noticed anything strange
            during the night, now is the time to share. We must work together to
            identify the wolves before they strike again.
          </div>
        </div>

        <div class="event speak">
          <div class="timestamp">02:32:52</div>
          <div class="speaker">Dorian Blackwood</div>
          <div class="content">
            Indeed, a tragic loss. Aurora deserved better than this fate. We
            must act quickly, but we should also be cautious in our discussions.
            I have noticed a few odd behaviors from some of us. It might be wise
            to keep a close eye on each other. Perhaps we should vote for
            someone whose actions seem most suspicious? What do you all think?
          </div>
        </div>

        <div class="event speak">
          <div class="timestamp">02:32:54</div>
          <div class="speaker">Elise Farrow</div>
          <div class="content">
            I agree with both Celeste and Dorian; Aurora's death cannot go
            unanswered. We need to maintain vigilance and communicate our
            observations clearly. If anyone felt uneasy about any actions taken
            last night, now is the time to voice your concerns. It's crucial we
            trust one another as we search for the wolves among us.
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:32:56</div>

          <div class="content">üó≥Ô∏è Voting phase. Time to make your choice.</div>
        </div>

        <div class="event speak">
          <div class="timestamp">02:32:56</div>
          <div class="speaker">Finn Alder</div>
          <div class="content">
            I share your sentiments, Celeste and Dorian. The loss of Aurora
            weighs heavily on us. We must be vigilant in our observations and
            actions. I noticed that during our gathering last night, there was a
            peculiar silence from certain individuals that felt out of
            place‚Äîperhaps a sign of fear or something more sinister. I urge
            everyone to recall their interactions from last night closely. We
            must identify any discrepancies in behavior as we prepare to vote
            for someone who may not truly be one of us.
          </div>
        </div>

        <div class="event action">
          <div class="timestamp">02:33:04</div>

          <div class="content">
            üó≥Ô∏è Majority condemns Aurora Harper. Execution at twilight.
          </div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:33:04</div>

          <div class="content">üó≥Ô∏è Votes are tallied.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:33:04</div>

          <div class="content">‚öñÔ∏è Twilight execution results.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:33:04</div>

          <div class="content">üåô Night returns.</div>
        </div>

        <div class="event action">
          <div class="timestamp">02:33:22</div>

          <div class="content">You performed action: kill Finn</div>
        </div>

        <div class="event action">
          <div class="timestamp">02:33:23</div>

          <div class="content">
            üó≥Ô∏è Celeste Moonseer voted for Dorian Blackwood
          </div>
        </div>

        <div class="event action">
          <div class="timestamp">02:33:23</div>

          <div class="content">üó≥Ô∏è Dorian Blackwood voted for none</div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:33:23</div>

          <div class="content">
            üó≥Ô∏è Vote summary: Dorian Blackwood: 1, none: 1
          </div>
        </div>

        <div class="event death">
          <div class="timestamp">02:33:26</div>

          <div class="content">Finn Alder was found dead at dawn.</div>
        </div>

        <div class="event phase">
          <div class="timestamp">02:33:26</div>

          <div class="content">
            üéÆ Game Over! Winner: Werewolves. Reason: [God] Werewolves win; they
            now match the village.
          </div>
        </div>
      </div>
    </div>

    <script>
      let selectedAction = null;
      let lastEventCount = 0;

      function selectAction(button, action) {
        selectedAction = action;
        document.querySelectorAll(".action-btn").forEach((btn) => {
          btn.classList.remove("selected");
        });
        if (button) {
          button.classList.add("selected");
        }

        // Show/hide textarea based on action type
        const textarea = document.getElementById("argument");
        if (action === "none") {
          textarea.style.display = "none";
          textarea.value = "";
        } else {
          textarea.style.display = "block";
          textarea.focus();
        }
      }

      function submitAction() {
        if (!selectedAction) {
          alert("Please select an action first");
          return;
        }

        const argument = document.getElementById("argument").value;
        const data = {
          action_type: selectedAction,
          argument: argument,
          timestamp: new Date().toISOString(),
        };

        // Try to write file via fetch
        fetch("save_action", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then(() => {
            // Disable controls
            document.getElementById("inputControls").style.display = "none";
            document.getElementById("status").textContent =
              "Action submitted! Waiting for next turn...";
            document.getElementById("inputBox").classList.remove("waiting");
            selectedAction = null;
            document.getElementById("argument").value = "";
          })
          .catch((err) => {
            console.error("Failed to save action:", err);
            alert("Failed to submit action. Please try again.");
          });
      }

      // Poll for updates without full page reload
      function checkForUpdates() {
        const inputBox = document.getElementById("inputBox");
        const isWaiting = inputBox.classList.contains("waiting");

        fetch(window.location.href + "?t=" + Date.now())
          .then((r) => r.text())
          .then((html) => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");
            const newInputBox = doc.getElementById("inputBox");
            const newEvents = doc.getElementById("events");

            // Always update events area (even while waiting) without reloading
            if (newEvents) {
              document.getElementById("events").innerHTML = newEvents.innerHTML;
              scrollToBottom();
            }

            // Only reload when transitioning from not waiting -> waiting
            if (
              !isWaiting &&
              newInputBox &&
              newInputBox.classList.contains("waiting")
            ) {
              location.reload();
            }
          })
          .catch(() => {});
      }

      // Auto-scroll to bottom
      function scrollToBottom() {
        const mainContent = document.querySelector(".main-content");
        if (mainContent) {
          mainContent.scrollTop = mainContent.scrollHeight;
        }
      }

      scrollToBottom();
      // Check for updates every 2 seconds
      setInterval(checkForUpdates, 2000);
    </script>
  </body>
</html>
